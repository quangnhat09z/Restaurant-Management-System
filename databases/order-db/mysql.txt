-- Tạo database
CREATE DATABASE restaurant_orders;
USE restaurant_orders;

-- Table: bill
CREATE TABLE IF NOT EXISTS bill (
    OrderID INT PRIMARY KEY AUTO_INCREMENT,
    CustomerName VARCHAR(100) NOT NULL,
    ContactNumber VARCHAR(15) NOT NULL,
    TotalPrice DECIMAL(10, 2) NOT NULL,
    OrderStatus ENUM('pending', 'preparing', 'ready', 'delivered', 'cancelled') DEFAULT 'pending',
    CreatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UpdatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_status (OrderStatus),
    INDEX idx_created (CreatedAt),
    INDEX idx_contact (ContactNumber)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Chạy lệnh mới này nhé để thêm cột CustomerID cho bảng bill: 
USE restaurant_orders;
ALTER TABLE bill ADD COLUMN CustomerID INT NULL;
CREATE INDEX idx_customer ON bill (CustomerID);

ALTER TABLE bill MODIFY COLUMN CustomerID INT NULL AFTER OrderID;

-- Table: item
CREATE TABLE IF NOT EXISTS item (
    ItemID INT PRIMARY KEY AUTO_INCREMENT,
    OrderID INT NOT NULL,
    ItemName VARCHAR(100) NOT NULL,
    TableNumber INT NOT NULL,
    Quantity INT NOT NULL,
    Price DECIMAL(10, 2) NOT NULL,
    CreatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (OrderID) REFERENCES bill(OrderID) ON DELETE CASCADE,
    INDEX idx_order (OrderID),
    INDEX idx_table (TableNumber)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

