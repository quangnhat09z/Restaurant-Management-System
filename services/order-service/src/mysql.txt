-- Tạo database
CREATE DATABASE restaurant_orders;
USE restaurant_orders;

-- Table: bill
CREATE TABLE IF NOT EXISTS bill (
    OrderID INT PRIMARY KEY AUTO_INCREMENT,
    CustomerName VARCHAR(100) NOT NULL,
    ContactNumber VARCHAR(15) NOT NULL,
    TotalPrice DECIMAL(10, 2) NOT NULL,
    OrderStatus ENUM('pending', 'preparing', 'ready', 'delivered', 'cancelled') DEFAULT 'pending',
    CreatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UpdatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_status (OrderStatus),
    INDEX idx_created (CreatedAt),
    INDEX idx_contact (ContactNumber)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Table: item
CREATE TABLE IF NOT EXISTS item (
    ItemID INT PRIMARY KEY AUTO_INCREMENT,
    OrderID INT NOT NULL,
    ItemName VARCHAR(100) NOT NULL,
    TableNumber INT NOT NULL,
    Quantity INT NOT NULL,
    Price DECIMAL(10, 2) NOT NULL,
    CreatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (OrderID) REFERENCES bill(OrderID) ON DELETE CASCADE,
    INDEX idx_order (OrderID),
    INDEX idx_table (TableNumber)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Sample order 1
INSERT INTO bill (CustomerName, ContactNumber, TotalPrice, OrderStatus) 
VALUES ('Nguyễn Văn A', '0901234567', 150000, 'pending');

SET @order_id = LAST_INSERT_ID();

INSERT INTO item (OrderID, ItemName, TableNumber, Quantity, Price) VALUES
(@order_id, 'Phở Bò', 5, 2, 50000),
(@order_id, 'Cà Phê Sữa Đá', 5, 2, 25000);

-- Sample order 2
INSERT INTO bill (CustomerName, ContactNumber, TotalPrice, OrderStatus) 
VALUES ('Trần Thị B', '0912345678', 95000, 'preparing');

SET @order_id = LAST_INSERT_ID();

INSERT INTO item (OrderID, ItemName, TableNumber, Quantity, Price) VALUES
(@order_id, 'Bún Chả', 8, 1, 45000),
(@order_id, 'Trà Đá', 8, 5, 10000);


select * from bill;
select * from item;